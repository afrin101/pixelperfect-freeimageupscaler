<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelPerfect - Image Upscaler</title>
    
    <!-- Favicon: "P" in Indigo Box -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%236366f1'/><text x='16' y='22' font-family='sans-serif' font-weight='bold' font-size='20' text-anchor='middle' fill='white'>P</text></svg>">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Vercel Web Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>

    <!-- Config & Styles -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                },
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'spin-slow': 'spin 3s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); }
        ::-webkit-scrollbar-thumb { background: rgba(71, 85, 105, 0.8); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(100, 116, 139, 1); }
        
        .pixelated { image-rendering: pixelated; }
        .smooth { image-rendering: auto; }
        
        /* Range Input Reset */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex flex-col transition-colors duration-300" id="app-body">

    <!-- Navigation -->
    <nav class="border-b border-slate-800 bg-slate-950/80 backdrop-blur-md sticky top-0 z-50 transition-colors duration-300" id="nav">
        <div class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
            <a href="javascript:window.location.reload()" class="flex items-center gap-2 hover:opacity-80 transition-opacity cursor-pointer" title="Reset Application">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center">
                    <i data-lucide="zap" class="text-white fill-white w-4 h-4"></i>
                </div>
                <span class="font-bold text-xl tracking-tight text-slate-100" id="logo-text">Pixel<span class="text-indigo-400">Perfect</span></span>
            </a>
            
            <div class="flex items-center gap-4 md:gap-6 text-sm font-medium">
                <div class="hidden md:flex items-center gap-6">
                    <button onclick="scrollToId('how-it-works')" class="text-slate-400 hover:text-white transition-colors nav-link">How it works</button>
                    <a href="#" class="text-slate-400 hover:text-white transition-colors nav-link">Pricing</a>
                    <button onclick="scrollToId('contact')" class="text-slate-400 hover:text-white transition-colors nav-link">Contact</button>
                </div>
                <button id="theme-toggle" class="p-2 rounded-lg text-indigo-400 hover:bg-slate-800 transition-colors">
                    <!-- Wrapped in spans so we can toggle the wrapper, keeping the SVG replacement safe -->
                    <span id="theme-sun-wrapper" class="hidden"><i data-lucide="sun" class="w-5 h-5"></i></span>
                    <span id="theme-moon-wrapper"><i data-lucide="moon" class="w-5 h-5"></i></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow max-w-6xl mx-auto px-6 py-12 w-full">

        <!-- Hero Section (Visible when no image) -->
        <div id="hero-section" class="animate-fade-in-up">
            <div class="text-center mb-12">
                <h1 class="text-5xl md:text-6xl font-extrabold mb-6 bg-clip-text text-transparent bg-gradient-to-b from-indigo-400 to-violet-600">
                    Enhance Images Instantly
                </h1>
                <p class="text-lg max-w-2xl mx-auto mb-10 text-slate-400 hero-text">
                    Upscale your images by up to 400% with our smart browser-based engine. 
                    <br class="hidden md:block" />
                    <span class="text-indigo-600 dark:text-indigo-400 font-medium">Images are processed locally on your device and never uploaded to a server.</span>
                </p>
            </div>

            <!-- Upload Area -->
            <div id="drop-zone" class="max-w-2xl mx-auto border-2 border-dashed border-slate-700 rounded-3xl p-12 text-center transition-all duration-300 cursor-pointer hover:border-slate-600 hover:bg-slate-900/50 group relative">
                <input type="file" id="file-input" class="hidden" accept="image/*">
                
                <div class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center mx-auto mb-6 shadow-xl shadow-black/20 group-hover:scale-110 transition-transform duration-300 upload-icon-bg">
                    <i data-lucide="upload" class="text-indigo-600 w-8 h-8"></i>
                </div>
                <h3 class="text-xl font-semibold mb-2 text-white upload-title">Click or Drag Image Here</h3>
                <p class="text-slate-500">Supports JPG, PNG, WEBP up to 10MB</p>
            </div>
        </div>

        <!-- Editor Section (Hidden initially) -->
        <div id="editor-section" class="hidden animate-fade-in grid lg:grid-cols-3 gap-8">
            
            <!-- Sidebar Controls -->
            <div class="lg:col-span-1 space-y-6">
                <div class="backdrop-blur-xl rounded-2xl p-6 border border-slate-800 bg-slate-900/50 card-bg">
                    
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-semibold text-lg flex items-center gap-2 text-white card-title">
                            <i data-lucide="sliders" class="text-indigo-400 w-4 h-4"></i>
                            Configuration
                        </h3>
                        <button id="reset-btn" class="text-xs text-slate-500 hover:text-red-400 transition-colors">
                            Remove Image
                        </button>
                    </div>

                    <!-- File Info -->
                    <div class="rounded-lg p-4 mb-6 border border-slate-800 bg-slate-950 info-bg">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded bg-slate-800 flex items-center justify-center info-icon-bg">
                                <i data-lucide="image" class="text-slate-400 w-5 h-5"></i>
                            </div>
                            <div class="overflow-hidden">
                                <p id="file-name" class="font-medium text-sm truncate text-white">filename.jpg</p>
                                <p id="file-dims" class="text-xs text-slate-500">1920 x 1080px</p>
                            </div>
                        </div>
                    </div>

                    <!-- Upscale Scale -->
                    <div class="mb-6">
                        <label class="text-sm font-medium mb-3 block text-slate-400 label-text">Upscale Factor</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button class="scale-btn p-3 rounded-xl border border-slate-700 bg-slate-800 text-slate-300 hover:bg-slate-700 transition-all font-semibold text-sm active-scale" data-scale="2">
                                2x <span class="text-xs opacity-70 block font-normal">Scale</span>
                            </button>
                            <button class="scale-btn p-3 rounded-xl border border-slate-700 bg-slate-800 text-slate-300 hover:bg-slate-700 transition-all font-semibold text-sm" data-scale="4">
                                4x <span class="text-xs opacity-70 block font-normal">Scale</span>
                            </button>
                        </div>
                    </div>

                    <!-- Mode -->
                    <div class="mb-8">
                        <label class="text-sm font-medium mb-3 block text-slate-400 label-text">Enhancement Mode</label>
                        <div class="space-y-3">
                            <button class="mode-btn w-full p-3 rounded-xl border border-indigo-500/50 bg-indigo-900/20 ring-1 ring-indigo-500 text-left flex items-center gap-3 transition-all active-mode" data-mode="smooth">
                                <div class="w-4 h-4 rounded-full border border-indigo-400 flex items-center justify-center radio-circle">
                                    <div class="w-2 h-2 rounded-full bg-indigo-400 radio-dot"></div>
                                </div>
                                <div>
                                    <span class="block text-sm font-medium text-white mode-title">Smart Smooth</span>
                                    <span class="text-xs text-slate-500">Best for photos & portraits</span>
                                </div>
                            </button>

                            <button class="mode-btn w-full p-3 rounded-xl border border-slate-700 bg-slate-800 text-left flex items-center gap-3 transition-all hover:bg-slate-750" data-mode="pixel">
                                <div class="w-4 h-4 rounded-full border border-slate-500 flex items-center justify-center radio-circle">
                                    <div class="w-2 h-2 rounded-full bg-indigo-400 radio-dot hidden"></div>
                                </div>
                                <div>
                                    <span class="block text-sm font-medium text-white mode-title">Pixel Crisp</span>
                                    <span class="text-xs text-slate-500">Best for pixel art & illustrations</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <button id="process-btn" class="w-full bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-500 hover:to-indigo-500 text-white shadow-lg shadow-indigo-500/30 font-semibold py-3 rounded-xl flex items-center justify-center gap-2 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-lucide="zap" class="w-5 h-5 btn-icon"></i> 
                        <span id="process-text">Upscale Image</span>
                    </button>
                </div>

                <!-- Success Message -->
                <div id="success-msg" class="hidden bg-emerald-900/20 border border-emerald-500/30 p-4 rounded-xl flex items-start gap-3 animate-fade-in">
                    <div class="w-6 h-6 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                        <i data-lucide="check" class="text-emerald-400 w-3 h-3"></i>
                    </div>
                    <div>
                        <p class="text-emerald-100 font-medium text-sm">Processing Complete</p>
                        <p id="success-details" class="text-emerald-500/70 text-xs mt-1">New resolution: 2000px x 2000px</p>
                    </div>
                </div>
            </div>

            <!-- Preview Area -->
            <div class="lg:col-span-2">
                <div class="backdrop-blur-xl rounded-2xl p-6 border border-slate-800 bg-slate-900/50 h-full flex flex-col relative overflow-hidden min-h-[500px] card-bg">
                    
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg text-white card-title">Preview</h3>
                        <div id="download-actions" class="hidden flex items-center gap-2">
                            <span class="text-slate-400 text-xs mr-2 uppercase tracking-wider font-bold label-text">Download:</span>
                            <button onclick="downloadImage('png')" class="px-3 py-1.5 text-xs rounded-lg border border-slate-600 text-slate-300 hover:bg-slate-800 hover:text-white flex items-center gap-1 transition-colors dl-btn">
                                <i data-lucide="download" class="w-3 h-3"></i> PNG
                            </button>
                            <button onclick="downloadImage('jpeg')" class="px-3 py-1.5 text-xs rounded-lg border border-slate-600 text-slate-300 hover:bg-slate-800 hover:text-white flex items-center gap-1 transition-colors dl-btn">
                                <i data-lucide="download" class="w-3 h-3"></i> JPG
                            </button>
                        </div>
                    </div>

                    <!-- Canvas Container -->
                    <div class="flex-1 rounded-xl relative overflow-hidden flex items-center justify-center border border-slate-800 bg-slate-950 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] preview-bg">
                        
                        <!-- Initial Placeholder -->
                        <div id="preview-placeholder" class="relative p-4">
                            <img id="img-placeholder-src" src="" alt="Original" class="max-w-full max-h-[600px] object-contain rounded shadow-2xl opacity-50">
                            <div class="absolute inset-0 bg-black/40 backdrop-blur-[1px] flex items-center justify-center rounded">
                                <p class="text-slate-300 font-medium flex items-center gap-2">
                                    <i data-lucide="layers" class="w-5 h-5"></i> Ready to upscale
                                </p>
                            </div>
                        </div>

                        <!-- Slider Component -->
                        <div id="compare-slider" class="hidden relative w-full h-full select-none cursor-col-resize group">
                            <div class="absolute inset-0 flex items-center justify-center p-4">
                                <div class="relative max-w-full max-h-full shadow-2xl rounded-lg overflow-hidden border border-slate-700" id="slider-container">
                                    
                                    <!-- After Image (Background) -->
                                    <img id="img-after" src="" class="max-w-full max-h-[600px] object-contain block pointer-events-none select-none" draggable="false">

                                    <!-- Before Image (Foreground/Clipped) -->
                                    <div id="img-before-container" class="absolute inset-0 overflow-hidden border-r-2 border-white shadow-[2px_0_10px_rgba(0,0,0,0.5)] bg-slate-900 w-1/2">
                                        <img id="img-before" src="" class="max-w-none h-full w-full object-contain pointer-events-none select-none pixelated" draggable="false">
                                        <div class="absolute bottom-4 left-4 bg-black/60 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">Original</div>
                                    </div>

                                    <!-- Handle -->
                                    <div id="slider-handle" class="absolute top-0 bottom-0 w-1 bg-transparent cursor-ew-resize z-10 left-1/2">
                                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white rounded-full shadow-lg flex items-center justify-center">
                                            <i data-lucide="move-horizontal" class="text-indigo-600 w-4 h-4"></i>
                                        </div>
                                    </div>

                                    <div class="absolute bottom-4 right-4 bg-indigo-600/80 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded">
                                        <span id="upscale-badge">2x</span> Upscaled
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Loading Overlay -->
                        <div id="loading-overlay" class="hidden absolute inset-0 backdrop-blur-sm bg-slate-900/80 flex flex-col items-center justify-center z-20 loading-bg">
                            <div class="relative w-24 h-24 mb-4">
                                <div class="absolute inset-0 border-4 border-slate-700 rounded-full spinner-bg"></div>
                                <div class="absolute inset-0 border-4 border-indigo-500 rounded-full border-t-transparent animate-spin"></div>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-white loading-text">Enhancing Details...</h3>
                            <p class="text-slate-400 loading-subtext">Applying algorithm</p>
                        </div>
                    </div>

                    <div class="mt-4 text-center">
                        <p class="text-xs text-slate-500">Use the slider to compare the original image with the generated version.</p>
                    </div>

                </div>
            </div>
        </div>

        <!-- How it Works -->
        <div id="how-it-works" class="mt-24 pt-12 border-t border-slate-800 animate-fade-in section-border">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-4 text-white section-title">How it Works</h2>
                <p class="text-slate-400 section-text">Professional grade upscaling in your browser.</p>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="p-8 rounded-2xl border border-slate-800 bg-slate-900/30 hover:border-indigo-500/30 transition-all group feature-card">
                    <div class="w-12 h-12 bg-indigo-900/20 rounded-xl flex items-center justify-center mb-6 text-indigo-400 group-hover:scale-110 transition-transform">
                        <i data-lucide="monitor" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 text-white feature-title">1. Upload Image</h3>
                    <p class="text-slate-400 text-sm leading-relaxed feature-text">Drag and drop any JPG, PNG, or WEBP image. We process everything locally in your browser.</p>
                </div>
                <div class="p-8 rounded-2xl border border-slate-800 bg-slate-900/30 hover:border-indigo-500/30 transition-all group feature-card">
                    <div class="w-12 h-12 bg-indigo-900/20 rounded-xl flex items-center justify-center mb-6 text-indigo-400 group-hover:scale-110 transition-transform">
                        <i data-lucide="mouse-pointer-2" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 text-white feature-title">2. Choose Mode</h3>
                    <p class="text-slate-400 text-sm leading-relaxed feature-text">Select <strong>Smart Smooth</strong> for photos or <strong>Pixel Crisp</strong> for pixel art and screenshots.</p>
                </div>
                <div class="p-8 rounded-2xl border border-slate-800 bg-slate-900/30 hover:border-indigo-500/30 transition-all group feature-card">
                    <div class="w-12 h-12 bg-indigo-900/20 rounded-xl flex items-center justify-center mb-6 text-indigo-400 group-hover:scale-110 transition-transform">
                        <i data-lucide="shield" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 text-white feature-title">3. Upscale & Save</h3>
                    <p class="text-slate-400 text-sm leading-relaxed feature-text">Increase resolution by up to 400%. Download instantly in PNG or JPG format.</p>
                </div>
            </div>
        </div>

        <!-- Contact -->
        <div id="contact" class="mt-24 pt-12 border-t border-slate-800 animate-fade-in text-center pb-12 section-border">
            <h2 class="text-3xl font-bold mb-4 text-white section-title">Get in Touch</h2>
            <p class="mb-8 max-w-lg mx-auto text-slate-400 section-text">Have questions? We're here to help.</p>
            
            <!-- Email Link with ID for JS targeting -->
            <a id="email-link" href="mailto:afrin220797@gmail.com" class="inline-flex items-center gap-3 bg-indigo-600/10 border border-indigo-500/50 text-indigo-600 px-8 py-4 rounded-2xl hover:bg-indigo-600 hover:text-white transition-all duration-300 group">
                <i data-lucide="mail" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium">afrin220797@gmail.com</span>
            </a>
        </div>
    </main>

    <!-- App Logic -->
    <script>
        // State
        const state = {
            file: null,
            originalImageSrc: null,
            processedImageSrc: null,
            dims: { width: 0, height: 0 },
            config: { scale: 2, mode: 'smooth' },
            isDark: true
        };

        // DOM Elements
        const elements = {
            dropZone: document.getElementById('drop-zone'),
            fileInput: document.getElementById('file-input'),
            heroSection: document.getElementById('hero-section'),
            editorSection: document.getElementById('editor-section'),
            fileName: document.getElementById('file-name'),
            fileDims: document.getElementById('file-dims'),
            scaleBtns: document.querySelectorAll('.scale-btn'),
            modeBtns: document.querySelectorAll('.mode-btn'),
            processBtn: document.getElementById('process-btn'),
            resetBtn: document.getElementById('reset-btn'),
            successMsg: document.getElementById('success-msg'),
            successDetails: document.getElementById('success-details'),
            previewPlaceholder: document.getElementById('preview-placeholder'),
            imgPlaceholderSrc: document.getElementById('img-placeholder-src'),
            compareSlider: document.getElementById('compare-slider'),
            imgBefore: document.getElementById('img-before'),
            imgAfter: document.getElementById('img-after'),
            imgBeforeContainer: document.getElementById('img-before-container'),
            sliderHandle: document.getElementById('slider-handle'),
            sliderContainer: document.getElementById('slider-container'),
            loadingOverlay: document.getElementById('loading-overlay'),
            downloadActions: document.getElementById('download-actions'),
            upscaleBadge: document.getElementById('upscale-badge'),
            themeToggle: document.getElementById('theme-toggle'),
            // Updated selectors to target the persistent span wrappers
            themeSun: document.getElementById('theme-sun-wrapper'),
            themeMoon: document.getElementById('theme-moon-wrapper'),
            body: document.getElementById('app-body'),
            nav: document.getElementById('nav'),
            // Added .feature-title here
            titles: document.querySelectorAll('.section-title, .card-title, .upload-title, .mode-title, .feature-title'),
            // Added .feature-text here
            texts: document.querySelectorAll('.section-text, .hero-text, .label-text, .loading-subtext, .feature-text'),
            cards: document.querySelectorAll('.feature-card, .card-bg'),
            borders: document.querySelectorAll('.section-border, .info-bg, .preview-bg, .spinner-bg'),
            btns: document.querySelectorAll('.dl-btn')
        };

        // Initialize Icons
        lucide.createIcons();

        // --- Theme Logic ---
        function toggleTheme() {
            state.isDark = !state.isDark;
            const isDark = state.isDark;

            // Body & Nav
            if (isDark) {
                document.documentElement.classList.add('dark');
                elements.body.classList.remove('bg-gray-100', 'text-slate-900');
                elements.body.classList.add('bg-slate-950', 'text-slate-100');
                
                elements.nav.classList.remove('bg-white/80', 'border-gray-300');
                elements.nav.classList.add('bg-slate-950/80', 'border-slate-800');

                elements.themeSun.classList.add('hidden');
                elements.themeMoon.classList.remove('hidden');

                // Text Colors
                document.getElementById('logo-text').classList.remove('text-slate-900');
                document.getElementById('logo-text').classList.add('text-slate-100');

                elements.titles.forEach(el => {
                    el.classList.remove('text-slate-900');
                    el.classList.add('text-white');
                });

                elements.texts.forEach(el => {
                    el.classList.remove('text-slate-600');
                    el.classList.add('text-slate-400');
                });

                // Cards & Borders
                elements.cards.forEach(el => {
                    el.classList.remove('bg-white', 'border-gray-300', 'shadow-md');
                    el.classList.add('bg-slate-900/50', 'border-slate-800');
                    if(el.classList.contains('feature-card')) el.classList.add('bg-slate-900/30');
                });

                elements.borders.forEach(el => {
                    el.classList.remove('border-gray-300', 'bg-gray-50', 'bg-gray-200');
                    if (el.classList.contains('info-bg')) el.classList.add('bg-slate-950', 'border-slate-800');
                    if (el.classList.contains('section-border')) el.classList.add('border-slate-800');
                    if (el.classList.contains('preview-bg')) el.classList.add('border-slate-800', 'bg-slate-950');
                });

                // Buttons
                elements.btns.forEach(el => {
                    el.classList.remove('border-gray-300', 'text-slate-600', 'hover:bg-gray-200');
                    el.classList.add('border-slate-600', 'text-slate-300', 'hover:bg-slate-800');
                });

                elements.dropZone.classList.remove('border-gray-300', 'hover:bg-white');
                elements.dropZone.classList.add('border-slate-700', 'hover:bg-slate-900/50');
                
            } else {
                document.documentElement.classList.remove('dark');
                elements.body.classList.add('bg-gray-100', 'text-slate-900');
                elements.body.classList.remove('bg-slate-950', 'text-slate-100');

                elements.nav.classList.add('bg-white/80', 'border-gray-300');
                elements.nav.classList.remove('bg-slate-950/80', 'border-slate-800');

                elements.themeMoon.classList.add('hidden');
                elements.themeSun.classList.remove('hidden');

                // Text Colors
                document.getElementById('logo-text').classList.add('text-slate-900');
                document.getElementById('logo-text').classList.remove('text-slate-100');

                elements.titles.forEach(el => {
                    el.classList.add('text-slate-900');
                    el.classList.remove('text-white');
                });

                elements.texts.forEach(el => {
                    el.classList.add('text-slate-600');
                    el.classList.remove('text-slate-400');
                });

                // Cards & Borders
                elements.cards.forEach(el => {
                    el.classList.add('bg-white', 'border-gray-300', 'shadow-md');
                    el.classList.remove('bg-slate-900/50', 'border-slate-800', 'bg-slate-900/30');
                });

                elements.borders.forEach(el => {
                    if (el.classList.contains('info-bg')) {
                        el.classList.add('bg-gray-50', 'border-gray-300');
                        el.classList.remove('bg-slate-950', 'border-slate-800');
                    }
                    if (el.classList.contains('section-border')) {
                        el.classList.add('border-gray-300');
                        el.classList.remove('border-slate-800');
                    }
                    if (el.classList.contains('preview-bg')) {
                        el.classList.add('border-gray-300', 'bg-gray-200');
                        el.classList.remove('border-slate-800', 'bg-slate-950');
                    }
                });

                 // Buttons
                 elements.btns.forEach(el => {
                    el.classList.add('border-gray-300', 'text-slate-600', 'hover:bg-gray-200');
                    el.classList.remove('border-slate-600', 'text-slate-300', 'hover:bg-slate-800');
                });

                elements.dropZone.classList.add('border-gray-300', 'hover:bg-white');
                elements.dropZone.classList.remove('border-slate-700', 'hover:bg-slate-900/50');
            }
            updateScaleButtons();
            updateModeButtons();
        }

        elements.themeToggle.addEventListener('click', toggleTheme);


        // --- Image Handling ---

        function handleFile(file) {
            if (!file || !file.type.match('image.*')) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    // Update State
                    state.file = file;
                    state.dims = { width: img.width, height: img.height };
                    state.originalImageSrc = e.target.result;
                    state.processedImageSrc = null;

                    // Update UI
                    elements.fileName.textContent = file.name;
                    elements.fileDims.textContent = `${img.width} x ${img.height}px`;
                    
                    elements.heroSection.classList.add('hidden');
                    elements.editorSection.classList.remove('hidden');
                    elements.editorSection.classList.add('animate-fade-in');
                    
                    // Reset Preview
                    elements.compareSlider.classList.add('hidden');
                    elements.previewPlaceholder.classList.remove('hidden');
                    elements.imgPlaceholderSrc.src = e.target.result;
                    elements.downloadActions.classList.add('hidden');
                    elements.successMsg.classList.add('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Drag & Drop
        elements.dropZone.addEventListener('click', () => elements.fileInput.click());
        elements.fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
        
        ['dragenter', 'dragover'].forEach(eventName => {
            elements.dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                elements.dropZone.classList.add('border-indigo-500', 'bg-indigo-500/10');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            elements.dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                elements.dropZone.classList.remove('border-indigo-500', 'bg-indigo-500/10');
            }, false);
        });

        elements.dropZone.addEventListener('drop', (e) => handleFile(e.dataTransfer.files[0]), false);

        // --- Config Logic ---

        function updateScaleButtons() {
            elements.scaleBtns.forEach(btn => {
                const scale = parseInt(btn.dataset.scale);
                if (scale === state.config.scale) {
                    btn.className = `scale-btn p-3 rounded-xl border border-indigo-500 bg-indigo-600 text-white shadow-lg shadow-indigo-900/50 transition-all font-semibold text-sm`;
                } else {
                    btn.className = `scale-btn p-3 rounded-xl border transition-all font-semibold text-sm ${state.isDark ? 'border-slate-700 bg-slate-800 text-slate-300 hover:bg-slate-700' : 'border-gray-300 bg-gray-200 text-slate-700 hover:bg-gray-300'}`;
                }
            });
            elements.upscaleBadge.textContent = `${state.config.scale}x`;
        }

        elements.scaleBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                state.config.scale = parseInt(btn.dataset.scale);
                updateScaleButtons();
            });
        });

        function updateModeButtons() {
            elements.modeBtns.forEach(btn => {
                const mode = btn.dataset.mode;
                const dot = btn.querySelector('.radio-dot');
                const circle = btn.querySelector('.radio-circle');
                const title = btn.querySelector('.mode-title');
                
                // Safety check to prevent errors
                if (!dot || !circle) return;
                
                if (mode === state.config.mode) {
                    btn.className = `mode-btn w-full p-3 rounded-xl border border-indigo-500/50 bg-indigo-900/20 ring-1 ring-indigo-500 text-left flex items-center gap-3 transition-all`;
                    dot.classList.remove('hidden');
                    // Important: Keep radio-circle class!
                    circle.className = `w-4 h-4 rounded-full border border-indigo-400 flex items-center justify-center radio-circle`;
                } else {
                    btn.className = `mode-btn w-full p-3 rounded-xl border text-left flex items-center gap-3 transition-all ${state.isDark ? 'border-slate-700 bg-slate-800 hover:bg-slate-750' : 'border-gray-300 bg-gray-200 hover:bg-gray-300'}`;
                    dot.classList.add('hidden');
                    // Important: Keep radio-circle class!
                    circle.className = `w-4 h-4 rounded-full border ${state.isDark ? 'border-slate-500' : 'border-slate-400'} flex items-center justify-center radio-circle`;
                }
            });
        }

        elements.modeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                state.config.mode = btn.dataset.mode;
                updateModeButtons();
            });
        });

        elements.resetBtn.addEventListener('click', () => {
            state.file = null;
            state.originalImageSrc = null;
            elements.heroSection.classList.remove('hidden');
            elements.editorSection.classList.add('hidden');
            elements.fileInput.value = '';
        });

        // --- Processing Logic ---

        elements.processBtn.addEventListener('click', async () => {
            if (!state.originalImageSrc) return;

            // UI Loading State
            elements.processBtn.disabled = true;
            elements.processBtn.innerHTML = `<i data-lucide="refresh-cw" class="w-5 h-5 animate-spin"></i> Processing...`;
            lucide.createIcons();
            elements.loadingOverlay.classList.remove('hidden');
            elements.compareSlider.classList.remove('hidden'); // Show container for overlay to sit on
            elements.previewPlaceholder.classList.add('hidden');

            // Fake Delay
            await new Promise(r => setTimeout(r, 1500));

            // Canvas Upscale
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = () => {
                const newW = state.dims.width * state.config.scale;
                const newH = state.dims.height * state.config.scale;
                
                canvas.width = newW;
                canvas.height = newH;
                
                if (state.config.mode === 'pixel') {
                    ctx.imageSmoothingEnabled = false;
                } else {
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                }

                ctx.drawImage(img, 0, 0, newW, newH);
                
                state.processedImageSrc = canvas.toDataURL(state.file.type);
                
                // Update Results UI
                elements.imgBefore.src = state.originalImageSrc;
                elements.imgAfter.src = state.processedImageSrc;
                
                if(state.config.mode === 'pixel') {
                    elements.imgAfter.classList.add('pixelated');
                    elements.imgAfter.classList.remove('smooth');
                } else {
                    elements.imgAfter.classList.add('smooth');
                    elements.imgAfter.classList.remove('pixelated');
                }

                elements.successDetails.textContent = `New resolution: ${newW}px x ${newH}px`;
                elements.successMsg.classList.remove('hidden');
                elements.downloadActions.classList.remove('hidden');
                
                // Reset Loading State
                elements.loadingOverlay.classList.add('hidden');
                elements.processBtn.disabled = false;
                elements.processBtn.innerHTML = `<i data-lucide="zap" class="w-5 h-5"></i> Upscale Image`;
                lucide.createIcons();
            };
            
            img.onerror = () => {
                 elements.processBtn.disabled = false;
                 elements.processBtn.innerHTML = `<i data-lucide="zap" class="w-5 h-5"></i> Upscale Image`;
                 lucide.createIcons();
                 elements.loadingOverlay.classList.add('hidden');
                 alert("Error processing image.");
            };
            
            img.src = state.originalImageSrc;
        });

        // --- Slider Logic ---

        let isDragging = false;

        function updateSlider(x) {
            const rect = elements.sliderContainer.getBoundingClientRect();
            let pos = ((x - rect.left) / rect.width) * 100;
            pos = Math.max(0, Math.min(100, pos));
            
            elements.imgBeforeContainer.style.width = `${pos}%`;
            elements.sliderHandle.style.left = `${pos}%`;
        }

        elements.compareSlider.addEventListener('mousedown', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        elements.compareSlider.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            updateSlider(e.clientX);
        });
        // Click to jump
        elements.compareSlider.addEventListener('click', (e) => updateSlider(e.clientX));

        // Touch support
        elements.compareSlider.addEventListener('touchstart', () => isDragging = true);
        window.addEventListener('touchend', () => isDragging = false);
        elements.compareSlider.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            e.preventDefault(); // Prevent scrolling while sliding
            updateSlider(e.touches[0].clientX);
        });

        // --- Download ---
        window.downloadImage = (format) => {
            if (!state.processedImageSrc) return;
            
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                
                if (format === 'jpeg') {
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
                
                ctx.drawImage(img, 0, 0);
                
                const link = document.createElement('a');
                link.download = `upscaled-${state.config.mode}-${state.config.scale}x.${format}`;
                link.href = canvas.toDataURL(`image/${format}`, 0.92);
                link.click();
            };
            img.src = state.processedImageSrc;
        };

        window.scrollToId = (id) => {
            document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
        };

        // --- Responsive Email Link Logic ---
        (function() {
            const emailLink = document.getElementById('email-link');
            if (emailLink) {
                // Simple check for mobile devices
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                if (!isMobile) {
                    // On Desktop, swap to the robust Google Mail web link so it opens in a new tab
                    // instead of trying to open a desktop mail client (Outlook/Mail)
                    emailLink.href = "https://mail.google.com/mail/?view=cm&fs=1&to=afrin220797@gmail.com";
                    emailLink.target = "_blank";
                    emailLink.rel = "noopener noreferrer";
                }
            }
        })();

    </script>
</body>
</html>
